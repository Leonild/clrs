(require-extension syntax-case check)
(require '../15.5/section)
(import section-15.5)
(let ((p (array-align (list->array 1 '(#f 0.04 0.06 0.08 0.02 0.10 0.12 0.14)) -1))
      (q (array-align (list->array 1 '(0.06 0.06 0.06 0.06 0.05 0.05 0.05 0.05)) -1)))
  (let-values (((e root) (memoized-bst p q)))
    (check (array->list e) =>
           '((#f #f #f #f #f #f #f #f #f)
             (0.06 0.28 0.62 1.02 1.34 1.83 2.44 3.12 #f)
             (#f 0.06 0.3 0.68 0.93 1.41 1.96 2.61 #f)
             (#f #f 0.06 0.32 0.57 1.04 1.48 2.13 #f)
             (#f #f #f 0.06 0.24 0.57 1.01 1.55 #f)
             (#f #f #f #f 0.05 0.3 0.72 1.2 #f)
             (#f #f #f #f #f 0.05 0.32 0.78 #f)
             (#f #f #f #f #f #f 0.05 0.34 #f)
             (#f #f #f #f #f #f #f 0.05 #f)))
    (check (array->list root) =>
           '((#f #f #f #f #f #f #f #f #f)
             (#f 0 1 1 1 2 2 4 #f)
             (#f #f 1 2 2 2 4 4 #f)
             (#f #f #f 2 2 3 4 4 #f)
             (#f #f #f #f 3 4 4 5 #f)
             (#f #f #f #f #f 4 5 5 #f)
             (#f #f #f #f #f #f 5 6 #f)
             (#f #f #f #f #f #f #f 6 #f)
             (#f #f #f #f #f #f #f #f #f)))))
